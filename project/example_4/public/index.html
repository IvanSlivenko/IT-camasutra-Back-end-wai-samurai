<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Test Fetch</title>
  </head>
  <body>
    <h3>Courses</h3>
    <!-- Пошук всіх курсів -->
    <button onclick="getAllCourses()">Пошук всіх</button>
    <script>
      function getAllCourses() {
        fetch("http://localhost:3000/courses", { method: "GET" })
          .then((res) => res.json())
          .then((json) => console.log("Всі курси:", json))
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Пошук одного  курсу -->
    <div>
      <input type="number" id="courseIdInput" placeholder="Введіть ID курсу" />
      <button onclick="getOunCourses()">Пошук одного</button>
    </div>
    <script>
      function getOunCourses() {
        const id = document.getElementById("courseIdInput").value;

        if (!id || isNaN(id)) {
          alert("Введіть коректний ID");
          return;
        }

        fetch(`http://localhost:3000/courses/${id}`, { method: "GET" })
          .then((res) => res.json())
          .then((json) => {
            console.log("Знайдено курс:", json);
            document.getElementById("courseIdInput").value = "";
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Пошук курсу за фільтром   -->
    <div>
      <input
        type="text"
        id="courseTitleFilter"
        placeholder="Введіть фрагмент для пошуку"
      />
      <button onclick="getOneCourseByFilter()">Пошук за фільтром</button>
    </div>
    <script>
      function getOneCourseByFilter() {
        const segmentTitle = document
          .getElementById("courseTitleFilter")
          .value.trim();

        if (!segmentTitle) {
          alert("Введіть фрагмент назви курсу");
          return;
        }

        fetch(
          `http://localhost:3000/courses?title=${encodeURIComponent(
            segmentTitle
          )}`
        )
          .then((res) => {
            if (!res.ok) {
              throw new Error("Помилка на сервері");
            }
            return res.json();
          })
          .then((json) => {
            if (json.length === 0) {
              console.log("Нічого не знайдено за фільтром.");
            } else {
              console.log("Результати фільтрації:", json);
              document.getElementById("courseTitleFilter").value = "";
            }
          })
          .catch((err) => console.error("Fetch error:", err.message));
      }
    </script>

    <!-- Пошук за фільтром без данних умови   -->
    <!-- <script>
    fetch('http://localhost:3000/courses', {method : 'GET'})
      .then(res => res.json())
      .then(json => console.log(json))
      .catch(err => console.error('Fetch error:', err));
  </script> -->

    <!-- Створення за замовчуванням   -->
    <!-- <script>
      fetch('http://localhost:3000/courses', {method : 'POST'})
        .then(res => res.json())
        .then(json => console.log(json))
        .catch(err => console.error('Fetch error:', err));
    </script> -->

    <!-- Створення з body   -->
    <!-- <script>
    fetch('http://localhost:3000/courses', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ title: '' })
    })
      // .then(res => res.json())
      .then(res => {
      console.log('Status:', res.status);
      return res.json();
    })
      .then(res => {
      console.log('Status:', res.status);
      return res.json();
    })
      .then(json => console.log(json))
      .catch(err => console.error('Fetch error:', err));
    </script> -->

    <!-- Створення з body    var 2-->
    <div>
      <input
        type="text"
        id="courseTitleInput"
        placeholder="Введіть назву нового курсу"
      />
      <button onclick="CreateOunCourse()">Створення одного за назвою</button>
    </div>
    <script>
      function CreateOunCourse() {
        let currentTitle = document.getElementById("courseTitleInput").value;

        if (currentTitle.trim() === "") {
          throw new Error("Title is required (400)");
        }

        fetch("http://localhost:3000/courses", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ title: currentTitle }),
        })
          .then(async (res) => {
            // console.log('Status:', res.status);
            const data = await res.json().catch(() => ({}));
            if (res.status >= 400) {
              console.warn("Server error response:", data);
            } else {
              console.log("Success:", data);
              document.getElementById("courseTitleInput").value = ""; // Очистити input
            }
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Видалення одного  курсу-->
    <div>
      <input
        type="number"
        id="courseIdInputDelete"
        placeholder="Введіть ID курсу для видалення"
      />
      <button onclick="deleteCourseById()">Видалити курс</button>
    </div>
    <script>
      function deleteCourseById() {
        const DeletedId = document
          .getElementById("courseIdInputDelete")
          .value.trim();

        if (!DeletedId || isNaN(DeletedId)) {
          alert("Введіть коректний ID курсу");
          return;
        }

        fetch(`http://localhost:3000/courses/${DeletedId}`)
          .then((res) => {
            if (!res.ok) {
              throw new Error(`Курс з id=${DeletedId} не знайдено`);
            }
            return res.json();
          })
          .then((json) => {
            const foundId = json.id;
            console.log("Знайдено курс:", json);

            return fetch(`http://localhost:3000/courses/${foundId}`, {
              method: "DELETE",
            });
          })
          .then((res) => {
            if (res.status === 204) {
              console.log("✅ Курс успішно видалено.");
              document.getElementById("courseIdInputDelete").value = ""; // Очистити input
            } else {
              return res.text().then((text) => {
                console.warn("⚠️ Відповідь сервера:", text);
              });
            }
          })
          .catch((err) => {
            console.error("❌ Помилка:", err.message);
          });
      }
    </script>

    <!-- Зміна одного  курсу-->
    <div>
      <input
        type="number"
        id="courseIdInputUpdate"
        placeholder="Введіть ID курсу для зміни"
      />
      <input
        type="text"
        id="courseTitleInputUpdate"
        placeholder="Введіть нову назву курсу для зміни"
      />
      <button onclick="updateCourseById()">Змінити курс</button>
    </div>
    <script>
      function updateCourseById() {
        const inputTitle = document.getElementById("courseTitleInputUpdate");
        const inputId = document.getElementById("courseIdInputUpdate");

        const currentTitleUpdatet = inputTitle.value.trim();
        const UpdateId = inputId.value.trim();

        if (currentTitleUpdatet === "") {
          alert("Поле назви не може бути порожнім");
          return;
        }

        if (!UpdateId || isNaN(UpdateId)) {
          alert("Введіть коректний ID курсу");
          return;
        }

        fetch(`http://localhost:3000/courses/${UpdateId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ title: currentTitleUpdatet }),
        })
          .then((res) => {
            if (!res.ok) {
              throw new Error(`Курс з id=${UpdateId} не знайдено`);
            }
            return res.json();
          })
          .then((json) => {
            console.log("✅ Курс успішно змінено:", json);
            // Очистити поля
            inputTitle.value = "";
            inputId.value = "";
          })
          .catch((err) => {
            console.error("❌ Помилка:", err.message);
          });
      }
    </script>

    <h2>Lesson 12</h2>

    <h3>Products</h3>
    <!-- Пошук всіх products   -->
    <button onclick="getAllProducts()">Пошук всіх products</button>
    <script>
      function getAllProducts() {
        fetch("http://localhost:3000/products", { method: "GET" })
          .then((res) => res.json())
          .then((json) => console.log("Всі products:", json))
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Пошук одного  product за фрагментом -->
    <div>
      <input type="text" id="productTitleInput" placeholder="Введіть назву" />
      <button onclick="getOunProduct()">
        Пошук одного продукту за фрагментом назви
      </button>
    </div>
    <script>
      function getOunProduct() {
        const foundTitle = document.getElementById("productTitleInput").value;
        if (!foundTitle || foundTitle.trim() === "") {
          alert("Введіть коректну назву продукту");
          return;
        }

        fetch(
          `http://localhost:3000/products/?title=${encodeURIComponent(
            foundTitle
          )}`,
          { method: "GET" }
        )
          .then((res) => res.json())
          .then((json) => {
            console.log("Знайдено продукт:", json);
            document.getElementById("productTitleInput").value = "";
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Пошук одного  product by id -->
    <div>
      <input type="number" id="productIdInput" placeholder="Введіть Id" />
      <button onclick="getOunProductById()">Пошук одного продукту за Id</button>
    </div>
    <script>
      function getOunProductById() {
        const foundProductId = document.getElementById("productIdInput").value;
        if (!foundProductId || foundProductId.trim() === "") {
          alert("Введіть коректну id продукту");
          return;
        }

        fetch(`http://localhost:3000/products/${foundProductId}`, {
          method: "GET",
        })
          .then((res) => res.json())
          .then((json) => {
            console.log("Знайдено продукт:", json);
            document.getElementById("productIdInput").value = "";
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Створення product з body    var 2-->

    <div>
      <input
        type="text"
        id="CreateProductTitleInput"
        placeholder="Введіть назву нового продукту"
      />
      <button onclick="CreateOunProduct()">
        Створення одного продукту за назвою
      </button>
    </div>
    <script>
      function CreateOunProduct() {
        let currentTitleProduct = document.getElementById(
          "CreateProductTitleInput"
        ).value;

        if (currentTitleProduct.trim() === "") {
          throw new Error("Title is required (400)");
        }

        fetch("http://localhost:3000/products", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ title: currentTitleProduct }),
        })
          .then(async (res) => {
            // console.log('Status:', res.status);
            const data = await res.json().catch(() => ({}));
            if (res.status >= 400) {
              console.warn("Server error response:", data);
            } else {
              console.log("Success:", data);
              document.getElementById("CreateProductTitleInput").value = ""; // Очистити input
            }
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Видалення одного  products-->
    <div>
      <input
        type="number"
        id="productIdInputDelete"
        placeholder="Введіть ID продукту для видалення"
      />
      <button onclick="deleteProductById()">Видалити продукт</button>
    </div>
    <script>
      function deleteProductById() {
        const DeletedId = document
          .getElementById("productIdInputDelete")
          .value.trim();

        if (!DeletedId || isNaN(DeletedId)) {
          alert("Введіть коректний ID продукту");
          return;
        }

        fetch(`http://localhost:3000/products/${DeletedId}`)
          .then((res) => {
            if (!res.ok) {
              throw new Error(`Продукт з id=${DeletedId} не знайдено`);
            }
            return res.json();
          })
          .then((json) => {
            const foundId = json.id;
            console.log("Знайдено продукт:", json);

            return fetch(`http://localhost:3000/products/${foundId}`, {
              method: "DELETE",
            });
          })
          .then((res) => {
            if (res.status === 204) {
              console.log("✅ Продукт успішно видалено.");
              document.getElementById("productIdInputDelete").value = ""; // Очистити input
            } else {
              return res.text().then((text) => {
                console.warn("⚠️ Відповідь сервера:", text);
              });
            }
          })
          .catch((err) => {
            console.error("❌ Помилка:", err.message);
          });
      }
    </script>

        <!-- Зміна одного  products-->
    <div>
      <input
        type="number"
        id="productIdInputUpdate"
        placeholder="Введіть ID продукту для зміни"
      />
      <input
        type="text"
        id="productTitleInputUpdate"
        placeholder="Введіть нову назву продукту для зміни"
      />
      <button onclick="updateProductById()">Змінити продукт</button>
    </div>
    <script>
      function updateProductById() {
        const inputTitle = document.getElementById("productTitleInputUpdate");
        const inputId = document.getElementById("productIdInputUpdate");

        const currentTitleUpdatet = inputTitle.value.trim();
        const UpdateId = inputId.value.trim();

        if (currentTitleUpdatet === "") {
          alert("Поле назви не може бути порожнім");
          return;
        }

        if (!UpdateId || isNaN(UpdateId)) {
          alert("Введіть коректний ID продукту");
          return;
        }

        fetch(`http://localhost:3000/products/${UpdateId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ title: currentTitleUpdatet }),
        })
          .then((res) => {
            if (!res.ok) {
              throw new Error(`Продукт з id=${UpdateId} не знайдено`);
            }
            return res.json();
          })
          .then((json) => {
            console.log("✅ Продукт успішно змінено:", json);
            // Очистити поля
            inputTitle.value = "";
            inputId.value = "";
          })
          .catch((err) => {
            console.error("❌ Помилка:", err.message);
          });
      }
    </script>

    <h3>Adresses</h3>

    <!-- Пошук всіх adresses   -->
    <button onclick="getAllAdresses()">Пошук всіх adresses</button>
    <script>
      function getAllAdresses() {
        fetch("http://localhost:3000/adresses", { method: "GET" })
          .then((res) => res.json())
          .then((json) => console.log("Всі adresses:", json))
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

    <!-- Пошук одного  adress by id -->
    <div>
      <input type="number" id="adresIDInput" placeholder="Введіть Id" />
      <button onclick="getOunAdrerssById()">Пошук одної адреси за Id</button>
    </div>
    <script>
      function getOunAdrerssById() {
        const foundAdressId = document.getElementById("adresIDInput").value;
        if (!foundAdressId || foundAdressId.trim() === "") {
          alert("Введіть коректну id адреси");
          return;
        }

        fetch(`http://localhost:3000/adresses/${foundAdressId}`, {
          method: "GET",
        })
          .then((res) => res.json())
          .then((json) => {
            console.log("Знайдено адресу:", json);
            document.getElementById("adresIDInput").value = "";
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

        <!-- Пошук одного  adress за фрагментом -->
    <div>
      <input type="text" id="adressTitleInput" placeholder="Введіть назву" />
      <button onclick="getOunAdress()">
        Пошук одної адреси за фрагментом назви
      </button>
    </div>
    <script>
      function getOunAdress() {
        const foundTitleAdress = document.getElementById("adressTitleInput").value;
        if (!foundTitleAdress || foundTitleAdress.trim() === "") {
          alert("Введіть коректну назву адреси");
          return;
        }

        fetch(
          `http://localhost:3000/adresses/?value=${encodeURIComponent(
            foundTitleAdress
          )}`,
          { method: "GET" }
        )
          .then((res) => res.json())
          .then((json) => {
            console.log("Знайдено адресу:", json);
            document.getElementById("adressTitleInput").value = "";
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

        <!-- Створення adress з body    var 2-->
    <div>
      <input
        type="text"
        id="CreateAdressTitleInput"
        placeholder="Введіть назву нової адреси"
      />
      <button onclick="CreateOunAdress()">
        Створення одної адреси за назвою
      </button>
    </div>
    <script>
      function CreateOunAdress() {
        let currentTitleAdress = document.getElementById(
          "CreateAdressTitleInput"
        ).value;

        if (currentTitleAdress.trim() === "") {
          throw new Error("Title is required (400)");
        }

        fetch("http://localhost:3000/adresses", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ value: currentTitleAdress }),
        })
          .then(async (res) => {
            // console.log('Status:', res.status);
            const data = await res.json().catch(() => ({}));
            if (res.status >= 400) {
              console.warn("Server error response:", data);
            } else {
              console.log("Success:", data);
              document.getElementById("CreateAdressTitleInput").value = ""; // Очистити input
            }
          })
          .catch((err) => console.error("Fetch error:", err));
      }
    </script>

        <!-- Видалення одного  adress-->
    <div>
      <input
        type="number"
        id="adressIdInputDelete"
        placeholder="Введіть ID адреси для видалення"
      />
      <button onclick="deleteAdressById()">Видалити адресу</button>
    </div>
    <script>
      function deleteAdressById() {
        const DeletedId = document
          .getElementById("adressIdInputDelete")
          .value.trim();

        if (!DeletedId || isNaN(DeletedId)) {
          alert("Введіть коректний ID адреси");
          return;
        }

        fetch(`http://localhost:3000/adresses/${DeletedId}`)
          .then((res) => {
            if (!res.ok) {
              throw new Error(`Адресу з id=${DeletedId} не знайдено`);
            }
            return res.json();
          })
          .then((json) => {
            const foundId = json.id;
            console.log("Знайдено адресу:", json);

            return fetch(`http://localhost:3000/adresses/${foundId}`, {
              method: "DELETE",
            });
          })
          .then((res) => {
            if (res.status === 204) {
              console.log("✅ Адресу успішно видалено.");
              document.getElementById("adressIdInputDelete").value = ""; // Очистити input
            } else {
              return res.text().then((text) => {
                console.warn("⚠️ Відповідь сервера:", text);
              });
            }
          })
          .catch((err) => {
            console.error("❌ Помилка:", err.message);
          });
      }
    </script>

            <!-- Зміна одного  adress-->
    <div>
      <input
        type="number"
        id="adressIdInputUpdate"
        placeholder="Введіть ID продукту для зміни"
      />
      <input
        type="text"
        id="adressTitleInputUpdate"
        placeholder="Введіть нову назву продукту для зміни"
      />
      <button onclick="updateProductById()">Змінити адресу</button>
    </div>
    <script>
      function updateProductById() {
        const inputTitle = document.getElementById("adressTitleInputUpdate");
        const inputId = document.getElementById("adressIdInputUpdate");

        const currentTitleUpdatet = inputTitle.value.trim();
        const UpdateId = inputId.value.trim();

        if (currentTitleUpdatet === "") {
          alert("Поле назви не може бути порожнім");
          return;
        }

        if (!UpdateId || isNaN(UpdateId)) {
          alert("Введіть коректний ID продукту");
          return;
        }

        fetch(`http://localhost:3000/adresses/${UpdateId}`, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({value: currentTitleUpdatet }),
        })
          .then((res) => {
            if (!res.ok) {
              throw new Error(`Адресу з id=${UpdateId} не знайдено`);
            }
            return res.json();
          })
          .then((json) => {
            console.log("✅ Адресу успішно змінено:", json);
            // Очистити поля
            inputTitle.value = "";
            inputId.value = "";
          })
          .catch((err) => {
            console.error("❌ Помилка:", err.message);
          });
      }
    </script>



  </body>
</html>
